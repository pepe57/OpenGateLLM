# ----------------------------------- models ------------------------------------
models:  
  - name: mistralai/Ministral-3-8B-Instruct-2512
    type: text-generation
    load_balancing_strategy: shuffle
    aliases: ["openweight-small"]
    cost_prompt_tokens: 1
    cost_completion_tokens: 3
    providers:
      - type: albert
        key: ${ALBERT_API_KEY}
        timeout: 120
        model_name: mistralai/Ministral-3-8B-Instruct-2512
        model_total_params: 8
        model_active_params: 8
        model_hosting_zone: FRA
        qos_metric: inflight
        qos_limit: 5

  - name: BAAI/bge-m3
    type: text-embeddings-inference
    aliases: ["openweight-embedding"]
    cost_prompt_tokens: 1
    cost_completion_tokens: 3
    providers:
      - type: albert
        key: ${ALBERT_API_KEY}
        timeout: 120
        model_name: BAAI/bge-m3
        model_total_params: 8
        model_active_params: 8
        model_hosting_zone: FRA
        max_parallel_requests: 5

  - name: openai/whisper-large-v3
    type: automatic-speech-recognition
    aliases: ["openweight-audio"]
    providers:
      - type: albert
        key: ${ALBERT_API_KEY}
        timeout: 120
        model_name: openai/whisper-large-v3
        model_total_params: 8
        model_active_params: 8
        model_hosting_zone: FRA
        max_parallel_requests: 5

# -------------------------------- dependencies ---------------------------------
dependencies:
  postgres:
    url: postgresql+asyncpg://postgres:changeme@localhost:${POSTGRES_PORT:-5432}/postgres
    echo: False
    pool_size: 10
    max_overflow: 5
    pool_pre_ping: True
    pool_recycle: 3600 
    pool_reset_on_return: commit
    connect_args:
      server_settings:
        statement_timeout: "120s"
      command_timeout: 60

  redis:
    url: redis://:changeme@localhost:${REDIS_PORT:-6379}
    max_connections: 200
    socket_keepalive: True
    socket_connect_timeout: 5
    retry_on_timeout: True
    health_check_interval: 30
    decode_responses: False
    socket_keepalive: True
  
  elasticsearch:
    hosts: http://localhost:${ELASTICSEARCH_PORT:-9200}
    basic_auth:
      - elasticsearch
      - changeme

  albert:
    headers:
      Authorization: Bearer ${ALBERT_API_KEY}

# ---------------------------------- settings -----------------------------------
settings:
  session_secret_key: -ftzKBct7qN22sgnkI9ApWD2ny_dHQVlPd2OPDSk5MM
  usage_tokenizer: tiktoken_gpt2
  log_level: DEBUG
  auth_key_max_expiration_days: 365
  monitoring_sentry_enabled: False
  monitoring_postgres_enabled: True
  monitoring_prometheus_enabled: True
  vector_store_model: BAAI/bge-m3
